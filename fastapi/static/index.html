<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <!-- 引入 ECharts 库 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- 引入 ECharts GL 扩展（用于3D图表） -->
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl@2.0.9/dist/echarts-gl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <style>
        #chart-container {
            width: 900px;
            height: 600px;
            margin: 0 auto;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="chart-container"></div>
</body>
    <script>

/**
 * 获取隧道点数据（使用 Promise.then）
 * @returns {Promise<Object>} 返回从API获取的数据
 */
async function fetchTunnelPointData() {
  try {
    const response = await fetch('http://8.136.1.153:8000/tunnel/point', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        // 如果需要其他头部信息，可以在这里添加
      },
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return data;
  } catch (error) {
    console.error('获取隧道点数据时出错:', error);
    throw error; // 可以选择重新抛出错误或返回默认值
  }
}

        // 自动生成series配置
        function generateSeries(rows) {
            const result = _.chain(rows).groupBy(row=>row[3]).value()
                return Object.values(result).map(obj => ({
                    type: 'scatter3D',
                    name: obj[0][3].toString(),  // 自动生成类别名称
                    data: obj,
                }))
        }


        // 初始化图表
        var chartDom = document.getElementById('chart-container');
        var myChart = echarts.init(chartDom);
        
        // 生成随机数据
        // function generateData() {
        //     var data = [[-8.25,-55.18,0.62,0],[-8.18,-45.49,-0.83,0],[-11.32,-54.73,-0.74,0],[-13.4,-54.28,0.67,0],[-13.3,-54.3,2.24,0],[-4.99,-35.9,0.88,1],[-8.18,-45.49,-0.83,1],[-9.71,-45.19,-0.85,1],[-11.87,-45.46,0.46,1],[-11.79,-45.43,2.14,1],[-7.28,-44.7,-0.83,2],[-8.18,-45.49,-0.83,2],[-9.71,-45.19,-0.85,2],[-10.26,-35.08,0.43,2],[-10.17,-35.07,1.86,2],[-3.53,-25.51,-0.14,3],[-4.97,-25.64,-1.16,3],[-6.55,-25.68,-1.18,3],[-8.58,-24.73,0.18,3],[-8.54,-24.7,1.63,3],[-2.03,-16.59,0.39,4],[-3.54,-15.76,-1.38,4],[-5.06,-15.54,-1.4,4],[-7.28,-15.85,0.1,4],[-7.2,-15.81,1.49,4],[-0.73,-6.19,-0.59,5],[-2.17,-6.19,-1.61,5],[-3.67,-5.47,-1.65,5],[-5.6,-3.99,-0.24,5],[-5.55,-3.96,1.15,5],[0.67,4.24,-0.85,6],[-0.78,3.87,-1.87,6],[-2.38,4.12,-1.89,6],[-4.39,4.93,-0.57,6],[-4.35,4.97,0.92,6],[1.94,14.66,-1.4,7],[0.52,14,-2.13,7],[-1.05,14.16,-2.14,7],[-2.97,15.35,-0.86,7],[-3.05,15.36,0.25,7],[3.33,23.63,-0.62,8],[1.79,24.05,-2.39,8],[0.17,24.24,-2.39,8],[-1.9,24.24,-1.05,8],[-1.93,24.27,0.17,8],[4.43,34.04,-1.62,9],[2.93,33.62,-2.63,9],[1.37,33.87,-2.63,9],[-0.64,34.65,-1.3,9],[-0.6,34.7,0.17,9],[5.56,42.99,-1.78,10],[4.18,43.77,-2.89,10],[2.62,43.92,-2.89,10],[0.46,43.58,-1.54,10],[0.51,43.63,-0.06,10]];
        //     return data;
        // }



        function genLegendData (rows) {
            return _.uniq(rows.map(row => row[3].toString()))
        }

async function main() {
        var data = await fetchTunnelPointData();
        // console.log(data)
                // 配置项
        var option = {
            // 标题
            title: {
                text: '',
                subtext: '',
                left: 'center'
            },
            // 提示框
            tooltip: {},
            // 图例
            legend: {
                data: genLegendData(data.data),
                right: 10,
                top: 20
            },
            // 三维坐标系
            grid3D: {
                viewControl: {
                    // 初始视角
                    alpha: 20,
                    beta: 40,
                    // 允许旋转
                    rotateSensitivity: 1,
                    // 允许缩放
                    zoomSensitivity: 1,
                    // 允许平移
                    panSensitivity: 1,
                    // 自动旋转
                    autoRotate: false
                },
                // 坐标轴配置
                axisLine: {
                    lineStyle: { color: '#999' }
                },
                axisPointer: {
                    lineStyle: { color: '#fff' }
                }
            },
            // x轴
            xAxis3D: {
                type: 'value',
                name: '东',
                min: -15,
                max: 6,
                axisLabel: {
                    formatter: '{value}'
                }
            },
            // y轴
            yAxis3D: {
                type: 'value',
                name: '北',
                min: -60,
                max: 60,
                axisLabel: {
                    formatter: '{value}'
                }
            },
            // z轴
            zAxis3D: {
                type: 'value',
                name: '高',
                min: -3,
                max: 3,
                axisLabel: {
                    formatter: '{value}'
                }
            },
            // 系列数据
            series: generateSeries(data.data)
        };
        
        // 使用配置项显示图表
        myChart.setOption(option);
}

        main()

        
        // 响应窗口大小变化
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>
</html>
